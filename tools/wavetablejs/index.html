<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<meta charset="ISO-8859-1"> 
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=EUC-JP" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="stylesheet" href="Wavetable%20calculator_files/style.css" type="text/css" />
    <link rel="contents" href="http://ppmck.web.fc2.com/contents.html" title="Contents" />
    <title>Wavetable calculator</title>
    <script type="text/javascript">
      <!--
      function debugout(str) {
      	window.document.F1.DEBUG.value = str;
      }


      var pi = Math.pi;
      var t_length;	//時間軸サイズ
      var y_height;	//電圧軸サイズ(波形最大値+1)


      var squ_amp; //矩形波用の振幅

      //範囲を0から1に制限する
      function norm1(x) {
      	return x - Math.floor(x);
      }

      //基本関数

      //sinみたいに使うけど
      //0〜2*piが0〜1に対応
      //値域はsinと同じく、-1〜1
      function sin(phase) {
      	return Math.sin(2 * Math.PI * phase);
      }

      function saw(phase) {
      	var n = norm1(phase);
      	return n*2 - 1;
      }


      //2番目の引数がasymm(引数が2個ないときはasymm = 0.5)
      //asymm = 0.5 で左右対称
      //>0.5だと中心が右に
      //<0.5だと中心が左に

      function squ(phase) {
      	var n = norm1(phase);
      	var asymm = 0.5;
      	switch (arguments.length) {
      	case 1:
      		break;
      	case 2:
      		asymm = arguments[1];
      		break;
      	default:
      		return 0;
      		break;
      	}
      	return (n < asymm ? squ_amp : -squ_amp);
      }


      function tri(phase) {
      	var n = norm1(phase);
      	var asymm = 0.5;
      	switch (arguments.length) {
      	case 1:
      		break;
      	case 2:
      		asymm = arguments[1];
      		break;
      	default:
      		return 0;
      		break;
      	}

      	var slope_p = 2.0 / asymm;
      	var slope_m = 2.0 / (1 - asymm);
      	return n < asymm ? -1 + slope_p * n : 1 - slope_m * (n - asymm);
      }




      //y_heightに合わせて高さを-1〜1の状態から持ち上げたり拡大したり
      function normalize(x) {
      	return Math.floor(x*(y_height/2) + y_height/2);
      }

      //sprintf("\$%02x", $num)を実現
      function toHexStr(num, prefix_str, signed_check) {
      	var prefix;

      	if (signed_check) {
      		prefix = prefix_str;
      		if (num >= 128) {
      			num = num - 128; //128, 129, 130, -> 0, 1, 2, 3,
      		} else {
      			num = num + 128; //127, 126, 125, -> 255, 254, 253
      		}
      	} else {
      		if (num >= 0) {
      			prefix = prefix_str;
      		} else {
      			prefix = "-" + prefix_str;
      			num = -num;
      		}
      	}
      	if (num < 16) {
      		prefix += "0";
      	}
      	return prefix + num.toString(16);
      }

      //$str x $numを実現
      function repeat_str(str, num) {
      	var j;
      	var ret = "";
      	for (j = 0; j < num; j++) {
      		ret += str;
      	}
      	return ret;
      }

      //メイン
      function calcmain() {
      	debugout("Initializing...");
      	t_length = parseInt(window.document.F1.N.value);
      	y_height = parseInt(window.document.F1.M.value) + 1;
      	squ_amp = (y_height - 1.0) / y_height;
      	debugout("Converting...");

      	var fdata = new Array(t_length);
      	var idata = new Array(t_length);
      	var t;
      	var datafunction = new Function("p", "return " + window.document.F1.FUNC.value + ";");
      	//debugout(datafunction);
      	//debugout(datafunction(1.0));

      	var signed_check;
      	if (window.document.F1.sign[0].checked) {
      		signed_check = false;
      	} else {
      		signed_check = true;
      	}
      	for (t = 0 ; t < t_length; t++) {
      		//phase (この値 1 に対し radianは 2*pi)
      		var p = (t + 0.5)/t_length; //tとt+1の平均値なので0.5を足している


      		//-90度から始める場合
      		//p -= 0.25;


      		var y;

      		y = datafunction(p);

      		fdata[t] = y;
      		idata[t] = normalize(y);
      	}

      	var min = idata[0];
      	var i;
      	for (i = 0; i < t_length; i++) {
      		min = min > idata[i] ? idata[i] : min;
      	}

      	//最小値を0に揃える
      	//var i;
      	//for (i = 0; i < t_length; i++) {
      	//	idata[i] = idata[i] - min;
      	//}

      	var graph_str = "";
      	for (i = 0; i < t_length; i++) {
      		graph_str += repeat_str("#", idata[i]);
      		graph_str += "\n";
      	}
      	graph_str += repeat_str("-", y_height - 1);
      	graph_str += "\n";
      	window.document.F1.GRAPH.value = graph_str;

      	var i;
      	var c;
      	for (i = 0; i < window.document.F1.format.length; i++) {
      		if (window.document.F1.format[i].checked) {
      			c = i;
      			break;
      		}
      	}
      	var result_vals = new Array(t_length);
      	switch (c) {
      		case 0:
      			for (i = 0; i < t_length; i++) {
      				result_vals[i] = idata[i];
      			}
      			break;
      		case 1:
      			for (i = 0; i < t_length; i++) {
      				result_vals[i] = toHexStr(idata[i], "$", signed_check);
      			}
      			break;
      		case 2:
      			for (i = 0; i < t_length; i++) {
      				result_vals[i] = toHexStr(idata[i], "0x", signed_check);
      			}
      			break;
      		case 3:
      			for (i = 0; i < t_length; i++) {
      				result_vals[i] = toHexStr(idata[i], "", signed_check);
      			}
      			break;
      		case 4:
      			for (i = 0; i < t_length; i++) {
      				result_vals[i] = fdata[i];
      			}
      			break;
      	}
      	var i;
      	var c;
      	for (i = 0; i < window.document.F1.separator.length; i++) {
      		if (window.document.F1.separator[i].checked) {
      			c = i;
      			break;
      		}
      	}
      	var sep;
      	switch (c) {
      		case 0:
      			sep = "";
      			break;
      		case 1:
      			sep = " ";
      			break;
      		case 2:
      			sep = ", ";
      			break;
      		case 3:
      			sep = ",";
      			break;
      		case 4:
      			sep = "\n";
      			break;
      	}

      	window.document.F1.TEXT.value = result_vals.join(sep);
      	debugout("OK");
      }

      function nmpreset(n, m, s) {
      	window.document.F1.N.value = n;
      	window.document.F1.M.value = m;
      	window.document.F1.sign[0].checked = 1-s;
      	window.document.F1.sign[1].checked = s;
      }

      function uncheckradio() {
      	var i;
      	for (i = 0; i < window.document.F1.preset.length; i++) {
      		window.document.F1.preset[i].checked = false;
      	}
      }

      // -->
    </script>
    <style></style>
  </head>
  <body style="scroll-behavior: auto !important;">
    <h1>Wavetable calculator</h1>
    <noscript>
      This form requires Javascript. Please enable it.
    </noscript>
    <p>
      <a href="help.html" target="_blank">HELP</a><br />
    </p>
    <form name="F1" action="#">
      <b>Preset:</b>
      <input type="radio" name="preset" value="fds" onclick="nmpreset(64,63,0)" />FDS |
      <input type="radio" name="preset" value="n106" onclick="nmpreset(32,15,0)" />N163/GB |
      <input type="radio" name="preset" value="hes" onclick="nmpreset(32,31,0)" />PC-Engine/HES |
      <input type="radio" name="preset" value="scc" onclick="nmpreset(32,255,1)" />SCC
      <br />
      <b>Wavedata length:</b>
      <input type="text" value="32" size="4" name="N" onchange="uncheckradio()" /><br />
      <b>Wavedata depth:</b>
      <input type="text" value="15" size="4" name="M" onchange="uncheckradio()" /><br />
      <b>Function:</b>
      <input
        type="text"
        value="0.5*sin(p) + 0.5*sin(4*p)"
        size="100"
        name="FUNC"
      /><br />
      <b>Data format:</b>
      <input type="radio" name="sign" value="0" checked="checked" />unsigned |
      <input type="radio" name="sign" value="1" />8bit signed (affects only if output format is
      hexadecimal)
      <br />
      <b>Output format:</b>
      <input type="radio" name="format" value="0" />decimal |
      <input type="radio" name="format" value="1" checked="checked" />$xxx |
      <input type="radio" name="format" value="2" />0xxx |
      <input type="radio" name="format" value="3" />xx |
      <input type="radio" name="format" value="4" />normalized float
      <br />
      <b>Separator:</b>
      <input type="radio" name="separator" value="" />"" |
      <input type="radio" name="separator" value=" " />" " |
      <input type="radio" name="separator" value=", " />", " |
      <input type="radio" name="separator" value="," checked="checked" />"," |
      <input type="radio" name="separator" value="nl" />"\n"
      <br />
      <br />
      <input type="button" value="Calculate" onclick="calcmain()" /><br />
      <br />
      Wavedata<br />
      <textarea cols="100" rows="3" name="TEXT"></textarea><br />
      <br />
      Graph<br />
      <textarea cols="100" rows="8" name="GRAPH"></textarea><br />
      <br /><br />
      debug: <input type="text" value="DEBUG" size="15" name="DEBUG" /><br />
    </form>
	<p>This page has been adapted from an old FC2 PPMCK page. I preserved it and roughly translated it to preserve it and open the tool up for international audiences. Special thanks to Defmech for helping prepare this page in particular. Original page by h7 (h7mailmail-at-yahoo co jp) (I am not sure if that address is still active, by the way)</p>
  </body>
</html>
